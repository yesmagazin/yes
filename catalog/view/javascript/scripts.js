function _setBrowser() {    let userAgent = navigator.userAgent.toLowerCase();    jQuery.browser = {        version: (userAgent.match(/.+(?:rv|it|ra|ie|me|ve)[\/: ]([\d.]+)/) || [])[1],        chrome: /chrome/.test(userAgent),        safari: /webkit/.test(userAgent) && !/chrome/.test(userAgent),        opera: /opera/.test(userAgent),        firefox: /firefox/.test(userAgent),        msie: /msie/.test(userAgent) && !/opera/.test(userAgent),        mozilla: /mozilla/.test(userAgent) && !/(compatible|webkit)/.test(userAgent),        gecko: /[^like]{4} gecko/.test(userAgent),        presto: /presto/.test(userAgent),        xoom: /xoom/.test(userAgent),        android: /android/.test(userAgent),        androidVersion: (userAgent.match(/.+(?:android)[\/: ]([\d.]+)/) || [0, 0])[1],        iphone: /iphone|ipod/.test(userAgent),        iphoneVersion: (userAgent.match(/.+(?:iphone\ os)[\/: ]([\d_]+)/) || [0, 0])[1].toString().split('_').join('.'),        ipad: /ipad/.test(userAgent),        ipadVersion: (userAgent.match(/.+(?:cpu\ os)[\/: ]([\d_]+)/) || [0, 0])[1].toString().split('_').join('.'),        blackberry: /blackberry/.test(userAgent),        winMobile: /Windows\ Phone/.test(userAgent),        winMobileVersion: (userAgent.match(/.+(?:windows\ phone\ os)[\/: ]([\d_]+)/) || [0, 0])[1]    };}//Общие скрипты$(document).ready(function () {    _setBrowser();    let defhh = 60;    if (location.hash) {        let hash = location.hash.replace(/[^a-z]+/,'');        if(hash == 'online' || hash == 'offline'){            let el = hash == 'online' && $('.online:visible').length ? '.online:visible' : '.offline:visible';            setTimeout(function () {                $('.category__sidebar-title,.good__desc-wrap button').removeClass('active');                $('.good__desc-text').removeClass('active');                let ind = $(el).index();                if($(window).width() <= 426) ind--;                $(el).addClass('active');                $(".good__desc-text").eq(ind).addClass("active");                $(el).scrollToElement(defhh);            });        } else {            setTimeout(function() {window.scrollTo(0,0);},10);        }    }    //Подчеркивание пунктов меню    $(".header__menu a").click(        function(){            $(this).toggleClass("active");        }    );    //Анимация при наведении на Каталог    $(".header__catalog").hover(        function () {            $(".catalog__wrap").stop(false, false).fadeIn(250).css("display", "flex").addClass("active");            $(".catalog__background").stop(false, false).fadeIn(500).css("display", "flex").addClass("active");            $(this).children().addClass("hover");        },        function () {            $(".catalog__wrap").stop(false, false).fadeOut(250).removeClass("active");            $(".catalog__background").stop(false, false).fadeOut(500).removeClass("active");            $(this).children().removeClass("hover");        }    );    //При клике изменение цвета кнопки у надписи Каталог    $(".header__catalog").click(        function () {            $(this).children("button").toggleClass("active");        }    );        // New Menu Tabs    $('#new-product-menu .top-level .item-link').on('mouseenter', function(){        if ( $(this).hasClass('active') ) return;        $('#new-product-menu .top-level .item-link.active').removeClass('active');        $('#new-product-menu .sub-level .top-item.active').removeClass('active');        $(this).addClass('active');        $('#new-product-menu .sub-level').find('.' + $(this).attr('id')).addClass('active');            })    //Смена слайдеров на главной    $(".items-slider__tab").click(        function () {            $(".items-slider__tab").removeClass("active");            $(this).addClass("active");            if ($("#items_slider_hits_button").hasClass("active")){                $("#items_slider_hits").addClass("active")            }            else{                $("#items_slider_hits").removeClass("active")            }            if ($("#items_slider_news_button").hasClass("active")) {                $("#items_slider_news").addClass("active")            }            else{                $("#items_slider_news").removeClass("active")            }        }    );    //Раскрытие карточки товара на главной    $(".items-slider__slide ").hover(        function () {            $(this).addClass("active");            $(this).children(".items-slider__slide-links").addClass("active");        },        function () {            $(this).removeClass("active");            $(this).children(".items-slider__slide-links").removeClass("active");        }    );    $(".collections-slider__slide ").hover(        function () {            $(this).addClass("active");            $(this).children(".collections-slider__slide-links").addClass("active");        },        function () {            $(this).removeClass("active");            $(this).children(".collections-slider__slide-links").removeClass("active");        }    );    //Управление мобильного меню    $(".mobile__catalog-button").click(        function (){            $(".mobile__menu-wrap").addClass("active");            $(".mobile__menu-main").addClass("active");            $(".mobile__menu-search-button").addClass("active");            $(".mobile__menu-close").addClass("active");        }    );    $(".mobile__search").click(        function () {            $(".mobile__menu-wrap").addClass("active");            $(".mobile__menu-search").addClass("active");            $(".mobile__menu-button").addClass("active");            $(".mobile__menu-close").addClass("active");        }    );    $(".mobile__menu-button").click(        function () {            $(this).removeClass("active");            $(".mobile__menu-close").addClass("active");            $(".mobile__menu-search-button").addClass("active");            $(".mobile__menu-catalog").removeClass("active");            $(".mobile__menu-main").addClass("active");            $(".mobile__menu-search").removeClass("active");        }    );    $(".mobile__menu-close").click(        function () {            $(this).removeClass("active");            $(".mobile__menu-wrap").removeClass("active");            $(".mobile__menu-main").removeClass("active");            $(".mobile__menu-catalog").removeClass("active");            $(".mobile__menu-search").removeClass("active");            $(".mobile__menu-button").removeClass("active");            $(".mobile__menu-search-button").removeClass("active");        }    );    $(".mobile__menu-search-button").click(        function () {            $(this).removeClass("active");            $(".mobile__menu-button").addClass("active");            $(".mobile__menu-main").removeClass("active");            $(".mobile__menu-catalog").removeClass("active");            $(".mobile__menu-search").addClass("active");        }    );    $(".mobile__menu-catalog-button").click(        function () {            $(".mobile__menu-button").addClass("active");            $(".mobile__menu-main").removeClass("active");            $(".mobile__menu-catalog").addClass("active");            $(".mobile__menu-search-button").removeClass("active");        }    );    $(".mobile__menu-catalog-category").click(        function () {            $(this).toggleClass("active");            $(this).next(".mobile__menu-catalog-list").toggleClass("active");        }    );    //Отображение языков и выбор    $(".header__language-wrap").hover(        function () {            $(this).children().children().addClass("hover");        },        function f() {            $(this).children().children().removeClass("hover");        }    );    $(".header__language").click(        function (e) {            e.preventDefault();            $(this).parent().children().removeClass("active");            $(this).addClass("active");            $('#form-language input[name=code]').val($(this).attr('rel'));            $('#form-language').submit();        }    );    $(".mobile__menu-language span").click(        function (e) {            e.preventDefault();            $(this).parent().children().removeClass("active");            $(this).addClass("active");            $('#form-language-m input[name=code]').val($(this).attr('rel'));            $('#form-language-m').submit();        }    );    //Выпадание поиска в хедере    $(".header__search").on('click',function() {        let $hf = $(".header__form");        let $o = $hf.data("open");        $hf.toggleClass('active').data('open', $o ? 0 : 1);    });    $(document).click(function(event) {        let $hf = $(".header__form");        if($hf.data("open") && !$(event.target).closest('.search-form').length) {            $hf.removeClass('active').data('open', 0);        }    });    //поиск    $('#search input[name=search]').parent().find('button').on('click', function() {        let url = $('base').attr('href') + 'index.php?route=product/search';        let value = $('#search input[name=search]').val();        if (value) {            url += '&search=' + encodeURIComponent(value);        }        location = url;    });    //Разворот пунктов сайдбара категории    $(".category__sidebar-title").click(        function () {            $(this).toggleClass("active");            $(this).next("div").toggleClass("active");        }    );    //Выбор пола    /*$(".category__sort-sex__box").click(        function () {            $(this).parent("div").children("div").removeClass("active");            $(this).addClass("active");        }    );*/    //Выбор чекбокса    $("[class $= pop-up], input").click(        function () {            $(this).prop("checked",true);        }    );    //Раскрытие размера    $("[class $= pop-up],[class $= button]").click(        function () {            $(this).addClass("active");            $(this).next("[class $= deep]").addClass("active");        }    );    //Раскрытие карточки товара в категори    $(".category__item ").hover(        function () {            $(this).addClass("active");            $(this).children(".category__item-links").addClass("active");        },        function () {            $(this).removeClass("active");            $(this).children(".category__item-links").removeClass("active");        }    );    //Раскрытие сортировок на мобилке    $(".category__head-filter button").click(        function () {            $(".category__sidebar").addClass("active");            $(".category__back").addClass("active")        }    );    $(".category__menu button, .category__back").click(        function () {            $(".category__sidebar").removeClass("active");            $(".category__back").removeClass("active")        }    );    //Отображение изображений в карточке товара    $(".document").ready(        function () {            let img = $(".good__img-small").children("img:first-child").attr("src");            $(".good__img-big img").attr("src", img);        }    );    //Перелистывание слайдов в карточке товара    $(".good__img-big--next").click(function () {        if ($(".good__img-small").children(".active").next("div").is("div")){            $(".good__img-small").children(".active").removeClass("active").next("div").addClass("active");        }        else{            $(".good__img-small").children(".active").removeClass("active").parent(".good__img-small").children("div:first").addClass("active");        }        let src = $(".good__img-small").children(".active").children("img").data("src");        $(".good__img-big img").attr("src", src);    });    $(".good__img-big--prev").click(function () {        if ($(".good__img-small").children(".active").prev("div").is("div")){            $(".good__img-small").children(".active").removeClass("active").prev("div").addClass("active");        }        else{            $(".good__img-small").children(".active").removeClass("active").parent(".good__img-small").children("div:last").addClass("active");        }        let src = $(".good__img-small").children(".active").children("img").data("src");        $(".good__img-big img").attr("src", src);    });    $(".good__img-small img").click(        function () {            let src = $(this).data("src");            $(".good__img-big img").attr("src", src);        }    );    $(".good__img-small div").click(        function () {            $(this).parent().children().removeClass("active");            $(this).addClass("active");        }    );    $(".good__option-desc button").click(        function () {            $(this).parent().find(".hidden").removeClass("hidden");            $(this).addClass("hidden");        }    );    $(".good__option-compare button").click(        function() {            $(this).parent("div").toggleClass("active");        }    );    $(".good__desc-head button").click(        function () {            $(this).parent("div").children("button").removeClass("active");            $(this).addClass("active");            let ind = $(this).index();            $(".good__desc-text").removeClass("active").eq(ind).addClass("active");        }    );    $('.good__option-review span>a').on('click', function(event) {        event.preventDefault();        let target = $('.rew:visible');        if( target.length ) {            $('.category__sidebar-title').removeClass('active');            $('.good__desc-text').removeClass('active');            target.trigger('click').scrollToElement(defhh);        }    });    $('#to_buy').on('click', function(e) {        e.preventDefault();        let shops = parseInt($(this).data('shops'));        let target = $('.online:visible');        if( shops && target.length  ) {            $('.category__sidebar-title').removeClass('active');            $('.good__desc-text').removeClass('active');            target.trigger('click').scrollToElement(defhh);        } else {            location = $(this).attr('href');        }    });    $('#send-contact').on('click', function(event) {        event.preventDefault();        grecaptcha.execute();    });    $('.header__city,.mobile__menu-address').on('click', function(event) {        modal($("#modal2"));    });    $('.category__sort-dop__button').on('click', function() {        let text = $(this).text();        $(this).text($(this).data('text')).data('text',text);        $($(this).data('target')).toggleClass('in');    });    $(window).scroll(function() {        if ($(this).scrollTop() > 1) {            $('nav').addClass("glide");        } else {            $('nav').removeClass("glide");        }    });    if($("#map").length){        $("#map").TekMap();        let marker = [] ;        let a = $("#good-obl option:selected").data('content');        let maps;        if(typeof a !== "undefined"){            $('.good__desc-filial-row').css('display','none').removeClass('maps');            $('.'+a).css('display','flex').addClass('maps');            maps = a=='good__desc-filial-row' ? false : true;            /*if($(".maps").length){                maps = true;            } else {                $(".good__desc-filial-row").css('display','flex').addClass('maps');                maps = false;            }*/        } else {            maps = false;        }        $('.maps').each(function(i,v) {            marker.push( {                lat:v.dataset.latitude,                lng:v.dataset.longitude,                draggable:false,                infowindow: v.dataset.title+'<br>'+ v.dataset.information,                icon:{url:"image/logo_maps.png",size:[75, 74],origin:[10,48]},                shadow:{url:"image/shadow50.png",size:[75, 74],origin:[10,48]}            });        });        $('#map').css({'height': '590px', 'width': '100%'});        $("#map").TekMap({            lat : maps ? $('.maps')[0].dataset.latitude : 48.379433,            lng : maps ? $('.maps')[0].dataset.longitude : 31.1655799000,            mapoptions : {                zoom: maps ? 12 : 6,                mapTypeId: google.maps.MapTypeId.ROADMAP,                scrollwheel: false            },            markers : marker        });    }    if($("#good-obl").length){        $("#good-obl").chosen({width: "100%"});        $("#good-obl").on("change", function() {            let chosenVal = $("#good-obl").val();            let maps;            let a = $("#good-obl option:selected").data('content');            $('.good__desc-filial-row').css('display', 'none');            $('.good__desc-filial-row').removeClass('maps');            maps = a=='good__desc-filial-row' ? false : true;            if($('.'+a).length > 0){                $('.'+a).css('display', 'flex');                $('.'+a).addClass('maps');                let marker = [] ;                $("#map").TekMap();                $('.maps').each(function(i,v) {                    marker.push( {                        lat:v.dataset.latitude,                        lng:v.dataset.longitude,                        draggable:false,                        infowindow:v.dataset.title+'<br>'+ v.dataset.information,                        icon:{url:"image/logo_maps.png",size:[75, 74],origin:[10,48]},                        shadow:{url:"image/shadow50.png",size:[75, 74],origin:[10,48]}                    });                });                $('#map').css({'height': '590px', 'width': '100%'});                if(maps) {                    $("#map").TekMap({                        lat:$('.maps')[0].dataset.latitude,                        lng:$('.maps')[0].dataset.longitude,                        mapoptions : {                            zoom: 12,                            mapTypeId: google.maps.MapTypeId.ROADMAP,                            scrollwheel: false                        },                        markers : marker                    });                } else {                    $("#map").TekMap({                        lat : 48.379433,                        lng : 31.1655799000,                        mapoptions : {                            zoom: 6,                            mapTypeId: google.maps.MapTypeId.ROADMAP,                            scrollwheel: false                        },                        markers : marker                    });                }            }else{                $("#map").TekMap();                let marker = [] ;                $('.good__desc-filial-row').each(function(i,v) {                    marker.push( {                        lat:v.dataset.latitude,                        lng:v.dataset.longitude,                        draggable:false,                        infowindow:v.dataset.title+'<br>'+ v.dataset.information,                        icon:{url:"image/logo_maps.png",size:[75, 74],origin:[10,48]},                        shadow:{url:"image/shadow50.png",size:[75, 74],origin:[10,48]}                    });                });                $('#map').css({'height': '590px', 'width': '100%'});                $("#map").TekMap({                    lat : 48.379433,                    lng : 31.1655799000,                    mapoptions : {                        zoom: 6,                        mapTypeId: google.maps.MapTypeId.ROADMAP,                        scrollwheel: false                    },                    markers : marker                });                $('.good__desc-filial-row').css('display', 'flex');            }        });    }    var modal = function(el){        swal({            type: '',            title: choose_title,            padding: '20px',            position: 'top',            html: el.html(),            reverseButtons: true,            showCancelButton: true,            confirmButtonColor: '#ff8400',            cancelButtonColor: '#aeaeae',            cancelButtonText: choose_close,            confirmButtonText: choose_select,            customClass: 'fadeIn',            animation: false,            showLoaderOnConfirm: true,            allowOutsideClick: function(){ !Swal.isLoading() },            preConfirm: () => {                let sel = $( "select#city_select option:selected" );                let cid = parseInt(sel.data("cid"));                if(sel.length && cid > 0){                    setCookieCId(cid);                    setTimeout(function(){                        location.reload();                    },500);                }                return false;            },            onOpen: () => {                $("#modal2 .select_cityy").remove();            }        }).then((result) => {            if (result.dismiss) {                setCookieCId(2);            }        });    };//    let popup_city = $.cookie("popup_city");    let popup_city = Cookies.get("popup_city");    /*if (popup_city == null || popup_city == 2) {        modal($("#modal2"));    }*/    function setCookieCId(value) {        Cookies.set('popup_city', value , {            expires: 30,            path: '/',        });    }    let buttons = document.querySelectorAll(".store__button");    let descs = document.getElementsByClassName("good__desc-text");    for (let x = 0; x < buttons.length; x++) {        buttons[x].addEventListener('click', function (e) {            e.preventDefault();            if (this.className.indexOf("active-button") != "-1") {                console.log("нашел")            } else {                document.getElementsByClassName("active-button")[0].classList.remove("active-button");                this.classList.add("active-button")                let type = this.getAttribute("data-type");                for(let y=0; y<descs.length;y++){                    if(descs[y].className.indexOf("active")!="-1"){                        descs[y].classList.remove("active")                    }                    else{                        descs[y].classList.add("active")                    }                }            }        })    }    if ($("#productThumbs").length > 0) {        $('.slider-for').slick({            slidesToShow: 1,            slidesToScroll: 1,            arrows: false,            dots: false,            fade: false,            rows: 0,            infinite: false,            asNavFor: '.slider-nav',            responsive: [                {                    breakpoint: 768,                    settings: {                        arrows: true                    }                }            ]        });        $('.slider-nav').slick({            vertical: true,            swipeToSlide: true,            slidesToShow: 4,            slidesToScroll: 1,                autoplay: true,                autoplaySpeed: 2000,            asNavFor: '.slider-for',            arrows: true,            prevArrow: '<button type="button" data-role="none" class="slick-prev slick-arrow" aria-label="Previous" role="button">Previous</button>',            nextArrow: '<button type="button" data-role="none" class="slick-next slick-arrow" aria-label="Next" role="button">Next</button>',            dots: false,            fade: false,            rows: 0,            infinite: false,            focusOnSelect: true,            responsive: [                {                    breakpoint: 1281,                    settings: {                        slidesToShow: 3,                        vertical: true                    }                },                {                    breakpoint: 1181,                    settings: {                        slidesToShow: 3,                        vertical: false                    }                },                {                    breakpoint: 961,                    settings: {                        slidesToShow: 5,                        vertical: true                    }                },                {                    breakpoint: 901,                    settings: {                        slidesToShow: 4                    }                },                {                    breakpoint: 768,                    settings: {                        slidesToShow: 1,                        vertical: false                    }                }            ]        });    }    if(typeof product_id !== 'undefined' && product_id){        let start = 3;        // $('.good__desc-reviews').load('index.php?route=product/product/reviewM&product_id='+product_id+'&start='+start);        // start+=3;        $('#button-review').on('click', function(event) {            event.preventDefault();            $('#button-review i').addClass('rotating');            grecaptcha.execute();        });        $(document).on('click','button.good__desc-review-button', function() {            $.ajax({                url: 'index.php?route=product/product/reviewM&product_id='+product_id+'&start='+start,                type: 'post',                success: function(otvet) {                    if(otvet){                        $('.good__desc-review-button').replaceWith(otvet);                        start+=3;                    }                },                error: function () {                    fireError('Error!','Cann not make request!');                }            });        });    }});let fireError = (title,text,ref) => {    Swal.fire({        type: 'error',        padding: '20px',        position: 'top',        title: title,        text: text,        animation: false,        customClass: 'slideInDown'    }).then((result) => {        if (typeof ref !== 'undefined' && (result.value || result.dismiss)) {            location = ref;        }    });};let compare = {    add: (product_id) => {        $.ajax({            url: 'index.php?route=product/compare/add',            type: 'post',            data: 'product_id=' + product_id,            dataType: 'json',            success: (json) => {                if (json['success']) {                    $('#compare-total').html(json['total']);                } else if (json['error']){                    fireError('Error!',json['str']);                }            },            error: (xhr, ajaxOptions, thrownError) => {                fireError(xhr.statusText,xhr.responseText);            }        });    },    remove: (product_id) => {        $.ajax({            url: 'index.php?route=product/compare/remove',            type: 'post',            data: 'product_id=' + product_id + '&ref=' + document.referrer,            dataType: 'json',            success: (json) => {                if (json['success']) {                    $('#comp'+product_id).remove();                    if(parseInt(json['cnt']) == 0){                        location = json['ref'] ? json['ref'] : '/';                    }                } else if (json['error']){                    if(parseInt(json['cnt']) == 0) {                        fireError('Error!',json['str'],document.referrer);                    } else {                        if(json['pid'] && $('#comp'+json['pid']).length){                            $('#comp'+json['pid']).remove();                        }                        fireError('Error!',json['str']);                    }                }            },            error: (xhr, ajaxOptions, thrownError) => {                fireError(xhr.statusText,xhr.responseText);            }        });    },    removeall: () => {        $.ajax({            url: 'index.php?route=product/compare/removeall',            type: 'post',            data: 'ref=' + document.referrer,            dataType: 'json',            success: (json) => {                if (json['success']) {                    location = json['ref'] ? json['ref'] : '/';                } else if (json['error']){                    fireError('Error!',json['str'],document.referrer&&document.referrer.search('compare')<0?document.referrer:'/');                }            },            error: (xhr, ajaxOptions, thrownError) => {                fireError(xhr.statusText,xhr.responseText);            }        });    }};window.onSubmit = function() {    $('#contacts-form').submit();};window.onSubmitRev = function() {    $.ajax({        url: $('#form-review').data('action'),        type: 'post',        dataType: 'json',        data: $('#form-review').serialize(),        success: (json) => {            $('#button-review i').removeClass('rotating');            $('.alert-success, .alert-danger').remove();            grecaptcha.reset();            if (json['error']) {                $('.good__desc-u-title').before('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + '</div>');            }            if (json['success']) {                $('.good__desc-u-title').before('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + '</div>');                $('input[name=\'name\']').val('');                $('textarea[name=\'text\']').val('');                $('input[name=\'rating\']:checked').prop('checked', false);            }        },        error: (error) => {            $('#button-review i').removeClass('rotating');            fireError('Error!','Cann not make request!');            grecaptcha.reset();        }    });};jQuery.fn.extend({    scrollToElement: function(offs) {        let that = this;        setTimeout(()=>{            let zoom = parseFloat($('body').css('zoom'));            if(typeof zoom === "undefined" || isNaN(zoom) || jQuery.browser.mozilla){                zoom = 1;            }            let box = that[0].getBoundingClientRect();            let body = document.body;            let docEl = document.documentElement;            let scrollTop = window.pageYOffset || docEl.scrollTop || body.scrollTop;            offs = typeof offs === "undefined" ? 0 : parseInt(offs);            let width = $(window).width();            if(width <= 426) offs += 31;            $('html, body').stop().animate({                scrollTop: (box.top-offs)*zoom + scrollTop            }, 500);        },50);    }});